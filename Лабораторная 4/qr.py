"""
QR-коды соответствуют международному стандарту ISO/IEC 18004, который определяет:

Структуру матрицы
Методы кодирования данных
Схемы коррекции ошибок
Версии (размеры) кода

1. 
Библиотека автоматически выбирает наиболее эффективный режим:

Numeric — только цифры (0–9)
Alphanumeric — цифры + заглавные латинские буквы + 11 спецсимволов (0–9, A–Z, , $, %, *, +, -, ., /, :)
Byte (8-bit) — любой байт (включая UTF-8)

2.

Добавление терминатора и выравнивание
В конец данных добавляется терминатор (0000)
Затем данные дополняются нулями до кратности 8 бит
Добавляются случайные биты (для равномерного распределения чёрного/белого)


3. 
Код Рида–Соломона (Reed–Solomon) — коррекция ошибок
Данные разбиваются на блоки,
Для каждого блока вычисляются ECC-байты (Error Correction Code),
Уровень коррекции:
    L — 7%,
    M — 15%,
    Q — 25%,
    H — 30%

4. 
Данные и ECC записываются в матрицу змейкой справа налево
Добавляются функциональные элементы:
Поисковые паттерны в трёх углах (для ориентации)
Линейки синхронизации
Информационные поля (версия, уровень ECC)
Маски (8 вариантов) — выбирается та, что даёт наиболее равномерное распределение чёрного/белого.

5.
Применение маски
Маска — битовая маска, которая инвертирует часть модулей по правилу
Выбирается лучшая маска по алгоритму оценки (минимизация блоков, дисбаланса и т.п.)
"""



"""barcode

Каждый символ кодируется как:

3 чёрные полосы + 3 белые полосы (всего 6 элементов)
Суммарная ширина — 11 модулей
Ширина каждого элемента — от 1 до 4 модулей
Компоненты штрих-кода
Начальный символ — определяет набор (code set)
    Code A: ASCII 0–95 (управляющие + символы + A–Z)
    Code B: ASCII 32–127 (пробел + латиница + цифры + знаки)
    Code C: только пары цифр (00–99) → очень плотный
Данные — последовательность символов в выбранном наборе
Контрольная сумма (check digit)
    Вычисляется как взвешенная сумма
    Гарантирует обнаружение ошибок
Стоп-символ — фиксированная последовательность.
Тихая зона (quiet zone) — белое поле по краям (≥10x ширины узкой полосы).
"""


import qrcode
from barcode import Code128
from barcode.writer import ImageWriter
from PIL import Image

# Генерация QR-кода
def generate_qr(data: str, filename: str):
    """
    Использует модульную структуру: чёрные/белые квадраты (модули)
    Содержит:
    Поисковые паттерны (угловые квадраты) — для ориентации
    Информационные биты — данные
    Коды коррекции ошибок (Reed–Solomon) — позволяют восстановить данные при повреждении
    Уровни коррекции:
    L — 7%
    M — 15%
    Q — 25%
    H — 30%

    Данные → побитовое кодирование → добавление ECC (Reed–Solomon) → размещение в матрице с поисковыми паттернами
    """
    qr = qrcode.QRCode(
        version=1,                # размер (1–40), 1 = 21x21
        error_correction=qrcode.constants.ERROR_CORRECT_H,  # 30% восстановление
        box_size=10,
        border=4,
    )
    qr.add_data(data)
    qr.make(fit=True)
    img = qr.make_image(fill_color="black", back_color="white")
    img.save(filename)
    print(f"QR-код сохранён: {filename}")

# Генерация штрих-кода (Code 128)
def generate_barcode(data: str, filename: str):
    '''Состоит из чёрных и белых вертикальных полос разной ширины
    Каждый символ = комбинация из 3 чёрных и 3 белых полос (всего 11 модулей)
    Нет коррекции ошибок! → очень чувствителен к повреждениям
    Требует чёткую геометрию и высокий контраст
    
    Каждый символ → последовательность из 6 полос (3 чёрных + 3 белых), закодированных в ширине
    '''

    # Code128 поддерживает буквы, цифры, спецсимволы
    barcode = Code128(data, writer=ImageWriter())
    barcode.save(filename.replace('.png', ''))  
    print(f"Штрих-код сохранён: {filename}")

# Основной запуск
if __name__ == "__main__":
    DATA_QR = "Меня зовут Максим! Hi"  
    DATA_BARCODE = "My name is Maksim! Hi"

    # Генерация
    generate_qr(DATA_QR, "qr_code.png")
    generate_barcode(DATA_BARCODE, "barcode.png")

    # Показать изображения
    try:
        Image.open("qr_code.png").show()
        Image.open("barcode.png").show()
    except:
        pass